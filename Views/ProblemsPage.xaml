<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="PiClientV1.Views.ProblemsPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Режим обучения">

	<ScrollView>
		<VerticalStackLayout Padding="15" Spacing="15">

			<!-- Заголовок -->
			<Label Text="🎓 Режим обучения π-исчислению"
                   FontSize="24"
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="#4CAF50"/>

			<!-- Выбор режима -->
			<Frame BackgroundColor="#E8F5E8" Padding="15">
				<VerticalStackLayout Spacing="10">
					<Label Text="Режим работы:"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#2E7D32"/>

					<Picker x:Name="ModePicker"
                            Title="Выберите режим"
                            SelectedIndexChanged="OnModeChanged">
						<Picker.Items>
							<x:String>learning</x:String>
							<x:String>auto</x:String>
						</Picker.Items>
					</Picker>

					<Label x:Name="ModeDescriptionLabel"
                           Text="Режим обучения: вы вводите каждый шаг вручную"
                           FontSize="12"
                           TextColor="#388E3C"/>
				</VerticalStackLayout>
			</Frame>

			<!-- Ввод процесса -->
			<Frame BackgroundColor="#E3F2FD" Padding="15">
				<VerticalStackLayout Spacing="10">
					<Label Text="Введите процесс для изучения:"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#1976D2"/>

					<Entry x:Name="ProcessInput"
                           Placeholder="a![b].0 | a?(x).0"
                           FontSize="14"/>

					<Button x:Name="StartLearningButton"
                            Text="🎯 Начать обучение"
                            BackgroundColor="#4CAF50"
                            Clicked="OnStartLearningClicked"/>
				</VerticalStackLayout>
			</Frame>

			<!-- Информация о сессии -->
			<Frame x:Name="SessionInfoFrame"
                   BackgroundColor="#FFF3E0"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="📚 Активная сессия обучения"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#E65100"/>

					<Label x:Name="SessionIdLabel"
                           Text="Сессия: ..."
                           FontSize="12"/>

					<Label x:Name="CurrentStateLabel"
                           Text="Состояние: ..."
                           FontSize="12"/>

					<Label x:Name="HintLabel"
                           Text="Подсказка: ..."
                           FontSize="12"
                           TextColor="#FF9800"/>
				</VerticalStackLayout>
			</Frame>

			<!-- Ввод шага -->
			<Frame x:Name="StepInputFrame"
                   BackgroundColor="#F3E5F5"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="Ваш следующий шаг:"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#7B1FA2"/>

					<Label x:Name="TaskDescriptionLabel"
                           Text="Опишите следующий шаг вычисления..."
                           FontSize="12"
                           TextColor="#9C27B0"/>

					<Entry x:Name="StepInput"
                           Placeholder="Введите ваш шаг..."
                           FontSize="14"/>

					<Grid ColumnDefinitions="*,*" ColumnSpacing="10">
						<Button x:Name="SubmitStepButton"
                                Text="✅ Проверить шаг"
                                BackgroundColor="#9C27B0"
                                Clicked="OnSubmitStepClicked"/>

						<Button x:Name="GetHintButton"
                                Grid.Column="1"
                                Text="💡 Подсказка"
                                BackgroundColor="#BA68C8"
                                Clicked="OnGetHintClicked"/>
					</Grid>
				</VerticalStackLayout>
			</Frame>

			<!-- Результат проверки -->
			<Frame x:Name="ResultFrame"
                   BackgroundColor="#E8EAF6"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label x:Name="ResultLabel"
                           Text="Результат проверки..."
                           FontSize="16"
                           FontAttributes="Bold"/>

					<Label x:Name="FeedbackLabel"
                           Text="Обратная связь..."
                           FontSize="12"/>

					<Label x:Name="ExplanationLabel"
                           Text="Объяснение..."
                           FontSize="12"/>
				</VerticalStackLayout>
			</Frame>

			<!-- Основная информация из StepResult -->
			<Frame x:Name="StepInfoFrame"
                   BackgroundColor="#F8F9FA"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="📊 Информация о шаге"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#2C3E50"/>

					<Label x:Name="StepCurrentStateLabel"
                           Text="Состояние: ..."
                           FontSize="12"/>

					<Label x:Name="StepLastActionLabel"
                           Text="Последнее действие: ..."
                           FontSize="12"/>
				</VerticalStackLayout>
			</Frame>

			<!-- Параллельные действия -->
			<Frame x:Name="ParallelActionsFrame"
                   BackgroundColor="#F3E5F5"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="🔄 Параллельные действия"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#7B1FA2"/>

					<ListView x:Name="ParallelActionsList"
                              HeightRequest="80"
                              HasUnevenRows="True">
						<ListView.ItemTemplate>
							<DataTemplate>
								<ViewCell>
									<Label Text="{Binding .}" FontSize="11" Margin="10,1"/>
								</ViewCell>
							</DataTemplate>
						</ListView.ItemTemplate>
					</ListView>
				</VerticalStackLayout>
			</Frame>

			<!-- Доступные редукции -->
			<Frame x:Name="ReductionsFrame"
                   BackgroundColor="#E1F5FE"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="🔄 Доступные редукции"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#01579B"/>

					<ListView x:Name="ReductionsList"
                              HeightRequest="80"
                              HasUnevenRows="True">
						<ListView.ItemTemplate>
							<DataTemplate>
								<ViewCell>
									<Label Text="{Binding .}" FontSize="11" Margin="10,1"/>
								</ViewCell>
							</DataTemplate>
						</ListView.ItemTemplate>
					</ListView>
				</VerticalStackLayout>
			</Frame>

			<!-- История обучения -->
			<Frame x:Name="HistoryFrame"
                   BackgroundColor="#F5F5F5"
                   Padding="15"
                   IsVisible="False">
				<VerticalStackLayout Spacing="10">
					<Label Text="📖 История обучения"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="#455A64"/>

					<ListView x:Name="HistoryList"
                              HeightRequest="150"
                              HasUnevenRows="True">
						<ListView.ItemTemplate>
							<DataTemplate>
								<ViewCell>
									<Label Text="{Binding .}" FontSize="11" Margin="10,2"/>
								</ViewCell>
							</DataTemplate>
						</ListView.ItemTemplate>
					</ListView>
				</VerticalStackLayout>
			</Frame>

			<!-- Управление -->
			<Grid ColumnDefinitions="*,*" ColumnSpacing="10">
				<Button x:Name="RefreshButton"
                        Text="🔄 Обновить"
                        BackgroundColor="#FF9800"
                        Clicked="OnRefreshClicked"/>

				<Button x:Name="ResetButton"
                        Grid.Column="1"
                        Text="🔄 Сбросить"
                        BackgroundColor="#F44336"
                        Clicked="OnResetClicked"/>
			</Grid>

		</VerticalStackLayout>
	</ScrollView>
</ContentPage>